<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>‡πÑ‡∏£‡πÄ‡∏î‡∏≠‡∏£‡πå - ‡∏ä‡∏∏‡∏°‡∏ä‡∏ô Delivery</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://static.line-scdn.net/liff/edge/2/sdk.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Prompt:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Prompt', sans-serif; background-color: #f3f4f6; }
        .hide-scrollbar::-webkit-scrollbar { display: none; }
        .hide-scrollbar { -ms-overflow-style: none; scrollbar-width: none; }
        
        /* Radar Animation */
        @keyframes radar {
            0% { transform: scale(0.5); opacity: 0.8; }
            100% { transform: scale(2); opacity: 0; }
        }
        .radar-ping::after {
            content: '';
            position: absolute;
            width: 100%; height: 100%;
            background-color: #f59e0b;
            border-radius: 50%;
            top: 0; left: 0;
            z-index: -1;
            animation: radar 2s infinite ease-out;
        }

        /* Toggle Switch */
        .toggle-checkbox:checked { right: 0; border-color: #10b981; }
        .toggle-checkbox:checked + .toggle-label { background-color: #10b981; }
    </style>
</head>
<body class="text-gray-800 antialiased h-screen flex flex-col overflow-hidden relative">

    <!-- üåü ‡πÇ‡∏´‡∏°‡∏î‡∏à‡∏≠‡∏î‡∏≥‡∏õ‡∏£‡∏∞‡∏´‡∏¢‡∏±‡∏î‡∏û‡∏•‡∏±‡∏á‡∏á‡∏≤‡∏ô (Black Screen Saver) üåü -->
    <div id="dim-screen-overlay" class="fixed inset-0 bg-black z-[9999] flex flex-col items-center justify-center text-center transition-opacity duration-500 hidden opacity-0 cursor-pointer" onclick="wakeUpScreen()">
        <div class="w-20 h-20 border-4 border-gray-800 rounded-full flex items-center justify-center mb-6 relative">
            <div class="absolute inset-0 border-4 border-amber-500 rounded-full animate-spin border-t-transparent"></div>
            <i class="fas fa-motorcycle text-3xl text-gray-700 animate-pulse"></i>
        </div>
        <h2 class="text-gray-500 text-xl font-bold mb-2">‡πÇ‡∏´‡∏°‡∏î‡∏õ‡∏£‡∏∞‡∏´‡∏¢‡∏±‡∏î‡∏û‡∏•‡∏±‡∏á‡∏á‡∏≤‡∏ô</h2>
        <p class="text-gray-600 text-sm">‡∏£‡∏∞‡∏ö‡∏ö‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏™‡πÅ‡∏Å‡∏ô‡∏´‡∏≤‡∏á‡∏≤‡∏ô‡∏≠‡∏¢‡∏π‡πà‡πÄ‡∏ö‡∏∑‡πâ‡∏≠‡∏á‡∏´‡∏•‡∏±‡∏á...</p>
        <div class="mt-12 bg-gray-900 px-6 py-3 rounded-full border border-gray-800 animate-bounce">
            <p class="text-gray-400 text-xs font-bold"><i class="fas fa-hand-pointer mr-2"></i> ‡πÅ‡∏ï‡∏∞‡∏´‡∏ô‡πâ‡∏≤‡∏à‡∏≠‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏™‡∏ß‡πà‡∏≤‡∏á‡∏Ç‡∏∂‡πâ‡∏ô</p>
        </div>
    </div>

    <!-- ‡∏´‡∏ô‡πâ‡∏≤‡∏à‡∏≠‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô -->
    <div id="liff-loading" class="fixed inset-0 bg-white z-50 flex flex-col items-center justify-center">
        <i class="fas fa-motorcycle text-5xl text-amber-500 mb-4 animate-bounce"></i>
        <h2 class="font-bold text-xl text-gray-800">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡∏£‡∏∞‡∏ö‡∏ö‡πÑ‡∏£‡πÄ‡∏î‡∏≠‡∏£‡πå...</h2>
    </div>

    <!-- ‡∏´‡∏ô‡πâ‡∏≤‡∏à‡∏≠‡πÅ‡∏™‡∏î‡∏á Error -->
    <div id="error-state" class="hidden h-full flex flex-col items-center justify-center p-6 text-center bg-white">
        <i class="fas fa-id-card text-6xl text-red-500 mb-4"></i>
        <h2 class="font-bold text-xl text-gray-800 mb-2">‡∏ö‡∏±‡∏ç‡∏ä‡∏µ‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏û‡∏£‡πâ‡∏≠‡∏°‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô</h2>
        <p class="text-sm text-gray-500" id="error-message">‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏™‡∏°‡∏±‡∏Ñ‡∏£‡πÄ‡∏õ‡πá‡∏ô‡πÑ‡∏£‡πÄ‡∏î‡∏≠‡∏£‡πå ‡∏´‡∏£‡∏∑‡∏≠‡∏£‡∏≠‡πÅ‡∏≠‡∏î‡∏°‡∏¥‡∏ô‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥‡∏ö‡∏±‡∏ç‡∏ä‡∏µ‡∏Å‡πà‡∏≠‡∏ô‡∏ô‡∏∞‡∏Ñ‡∏∞</p>
    </div>

    <!-- ‡∏ï‡∏±‡∏ß‡πÅ‡∏≠‡∏õ‡∏´‡∏•‡∏±‡∏Å -->
    <div id="app-container" class="hidden max-w-md w-full mx-auto bg-gray-50 h-full relative flex flex-col shadow-2xl">
        
        <!-- HEADER -->
        <header class="bg-gray-800 text-white p-4 shadow-md z-20 flex justify-between items-center shrink-0 transition-colors duration-300" id="main-header">
            <div class="flex items-center gap-3">
                <div class="w-10 h-10 bg-white rounded-full flex items-center justify-center overflow-hidden border-2 border-transparent p-0.5" id="profile-border">
                    <img src="https://api.dicebear.com/7.x/avataaars/svg?seed=Rider" class="w-full h-full bg-gray-100 rounded-full grayscale transition-all duration-300" id="profile-img">
                </div>
                <div>
                    <h1 class="font-bold text-sm" id="rider-name">‡πÇ‡∏´‡∏•‡∏î‡∏ä‡∏∑‡πà‡∏≠...</h1>
                    <div class="flex items-center gap-1">
                        <div class="w-2 h-2 bg-gray-500 rounded-full" id="status-dot"></div>
                        <p class="text-[10px] text-gray-300 font-medium" id="status-text">‡∏≠‡∏≠‡∏ü‡πÑ‡∏•‡∏ô‡πå (‡∏û‡∏±‡∏Å‡∏ú‡πà‡∏≠‡∏ô)</p>
                    </div>
                </div>
            </div>
            
            <!-- ‡∏™‡∏ß‡∏¥‡∏ï‡∏ä‡πå ‡πÄ‡∏õ‡∏¥‡∏î-‡∏õ‡∏¥‡∏î ‡∏£‡∏±‡∏ö‡∏á‡∏≤‡∏ô -->
            <div class="flex flex-col items-end">
                <div class="relative inline-block w-12 align-middle select-none transition duration-200 ease-in mb-1">
                    <input type="checkbox" id="toggle-online" class="toggle-checkbox absolute block w-6 h-6 rounded-full bg-white border-4 appearance-none cursor-pointer transition-all duration-300" onchange="toggleOnlineStatus()"/>
                    <label for="toggle-online" class="toggle-label block overflow-hidden h-6 rounded-full bg-gray-400 cursor-pointer transition-colors duration-300"></label>
                </div>
                <p class="text-[9px] text-gray-300 font-bold">‡∏™‡∏ß‡∏¥‡∏ï‡∏ä‡πå‡∏£‡∏±‡∏ö‡∏á‡∏≤‡∏ô</p>
            </div>
        </header>

        <!-- MAIN CONTENT AREA -->
        <main class="flex-1 overflow-y-auto relative">
            
            <!-- VIEW 1: JOB BOARD -->
            <div id="view-job-board" class="flex flex-col h-full relative">
                
                <!-- ‡∏°‡πà‡∏≤‡∏ô‡∏ö‡∏±‡∏á‡∏ï‡∏≠‡∏ô‡∏≠‡∏≠‡∏ü‡πÑ‡∏•‡∏ô‡πå -->
                <div id="offline-overlay" class="absolute inset-0 bg-white/80 backdrop-blur-sm z-10 flex flex-col items-center justify-center text-center p-6 transition-all duration-300">
                    <i class="fas fa-bed text-6xl text-gray-300 mb-4"></i>
                    <h2 class="text-xl font-bold text-gray-600 mb-2">‡∏Ñ‡∏∏‡∏ì‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏≠‡∏≠‡∏ü‡πÑ‡∏•‡∏ô‡πå</h2>
                    <p class="text-sm text-gray-500">‡πÄ‡∏õ‡∏¥‡∏î‡∏™‡∏ß‡∏¥‡∏ï‡∏ä‡πå‡∏°‡∏∏‡∏°‡∏Ç‡∏ß‡∏≤‡∏ö‡∏ô‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏™‡πÅ‡∏Å‡∏ô‡∏´‡∏≤‡∏á‡∏≤‡∏ô<br>‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏õ‡∏¥‡∏î‡∏´‡∏ô‡πâ‡∏≤‡∏à‡∏≠‡∏ô‡∏µ‡πâ‡∏Ñ‡πâ‡∏≤‡∏á‡πÑ‡∏ß‡πâ ‡∏£‡∏∞‡∏ö‡∏ö‡∏à‡∏∞‡∏õ‡πâ‡∏≠‡∏á‡∏Å‡∏±‡∏ô‡∏à‡∏≠‡∏î‡∏±‡∏ö‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥</p>
                </div>

                <!-- ‡πÄ‡∏£‡∏î‡∏≤‡∏£‡πå‡∏™‡πÅ‡∏Å‡∏ô‡∏´‡∏≤‡∏á‡∏≤‡∏ô -->
                <div class="bg-white p-4 flex flex-col items-center justify-center border-b border-gray-200 shrink-0 h-40 relative overflow-hidden">
                    <div class="absolute inset-0 opacity-5" style="background-image: radial-gradient(#f59e0b 1px, transparent 1px); background-size: 10px 10px;"></div>
                    <div class="w-10 h-10 bg-amber-500 text-white rounded-full flex items-center justify-center text-lg mb-2 relative radar-ping shadow-lg shadow-amber-500/50">
                        <i class="fas fa-satellite-dish"></i>
                    </div>
                    <p class="text-sm font-bold text-amber-600 mb-1">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡∏á‡∏≤‡∏ô...</p>
                    <p class="text-[10px] text-gray-400 mb-3">‡∏£‡∏∞‡∏ö‡∏ö‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥‡∏ó‡∏∏‡∏Å‡πÜ 10 ‡∏ß‡∏¥‡∏ô‡∏≤‡∏ó‡∏µ</p>
                    
                    <!-- ‡∏õ‡∏∏‡πà‡∏°‡∏ó‡∏î‡∏•‡∏≠‡∏á‡∏à‡∏≥‡∏•‡∏≠‡∏á‡∏á‡∏≤‡∏ô‡πÄ‡∏Ç‡πâ‡∏≤ -->
                    <button onclick="simulateNewJob()" class="bg-gray-800 hover:bg-gray-900 text-white text-[10px] font-bold py-1.5 px-3 rounded-full shadow-sm active:scale-95 transition-transform z-20">
                        <i class="fas fa-flask mr-1"></i> ‡πÄ‡∏ó‡∏™‡∏ï‡πå‡∏á‡∏≤‡∏ô‡πÄ‡∏Ç‡πâ‡∏≤ (‡∏à‡∏≥‡∏•‡∏≠‡∏á)
                    </button>
                </div>

                <!-- ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏á‡∏≤‡∏ô‡∏ó‡∏µ‡πà‡πÄ‡∏î‡πâ‡∏á‡πÄ‡∏Ç‡πâ‡∏≤‡∏°‡∏≤ -->
                <div class="p-4 space-y-4" id="job-list-container">
                    <!-- ‡πÇ‡∏Ñ‡πâ‡∏î‡∏à‡∏∞‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏Å‡∏≤‡∏£‡πå‡∏î‡∏á‡∏≤‡∏ô‡∏°‡∏≤‡πÉ‡∏™‡πà‡∏ï‡∏£‡∏á‡∏ô‡∏µ‡πâ -->
                </div>
            </div>

            <!-- VIEW 2: ACTIVE JOB -->
            <div id="view-active-job" class="hidden flex-col h-full bg-white">
                <div class="bg-amber-50 p-3 border-b border-amber-100 flex justify-between items-center px-4 shrink-0">
                    <span class="font-bold text-amber-700 text-sm"><i class="fas fa-motorcycle mr-1"></i> ‡∏á‡∏≤‡∏ô‡∏ó‡∏µ‡πà‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏Å‡∏≤‡∏£</span>
                    <span class="text-xs text-amber-600 font-bold" id="active-order-id">#...</span>
                </div>

                <div class="flex-1 overflow-y-auto p-4">
                    <div class="border-l-2 border-dashed border-gray-300 ml-3 pl-6 relative space-y-6">
                        
                        <!-- ‡∏à‡∏∏‡∏î‡∏ó‡∏µ‡πà 1: ‡∏£‡∏±‡∏ö‡∏≠‡∏≤‡∏´‡∏≤‡∏£‡∏ó‡∏µ‡πà‡∏£‡πâ‡∏≤‡∏ô -->
                        <div class="relative">
                            <div class="absolute -left-[33px] top-0 w-6 h-6 bg-gray-800 rounded-full border-2 border-white flex items-center justify-center text-white text-[10px]"><i class="fas fa-store"></i></div>
                            <h2 class="font-bold text-lg text-gray-800 mb-1" id="active-shop-name">‡∏£‡πâ‡∏≤‡∏ô...</h2>
                            <p class="text-xs text-gray-500 mb-2">‡πÄ‡∏Ç‡πâ‡∏≤‡πÑ‡∏õ‡∏£‡∏±‡∏ö‡∏≠‡∏≤‡∏´‡∏≤‡∏£‡∏ó‡∏µ‡πà‡∏£‡πâ‡∏≤‡∏ô‡∏ô‡∏µ‡πâ (‡∏ö‡∏≠‡∏Å‡∏£‡∏´‡∏±‡∏™‡∏≠‡∏≠‡πÄ‡∏î‡∏≠‡∏£‡πå‡∏Å‡∏±‡∏ö‡∏£‡πâ‡∏≤‡∏ô)</p>
                            
                            <div class="bg-amber-50 border border-amber-200 rounded-xl p-3 mb-2 shadow-sm">
                                <p class="text-[10px] font-bold text-amber-600 mb-1">‡∏Ñ‡∏∏‡∏ì‡∏à‡∏∞‡πÑ‡∏î‡πâ‡∏Ñ‡πà‡∏≤‡∏™‡πà‡∏á‡∏à‡∏≤‡∏Å‡∏£‡πâ‡∏≤‡∏ô</p>
                                <p class="text-xl font-bold text-gray-800"><span id="active-delivery-fee">0</span> ‡∏ø</p>
                            </div>
                        </div>

                        <!-- ‡∏à‡∏∏‡∏î‡∏ó‡∏µ‡πà 2: ‡∏™‡πà‡∏á‡∏≠‡∏≤‡∏´‡∏≤‡∏£‡πÉ‡∏´‡πâ‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤ -->
                        <div class="relative">
                            <div class="absolute -left-[33px] top-0 w-6 h-6 bg-emerald-500 rounded-full border-2 border-white flex items-center justify-center text-white text-[10px]"><i class="fas fa-home"></i></div>
                            <h2 class="font-bold text-lg text-gray-800 mb-1">‡∏™‡πà‡∏á‡πÉ‡∏´‡πâ‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤‡∏ó‡∏µ‡πà‡∏ö‡πâ‡∏≤‡∏ô</h2>
                            <p class="text-xs text-gray-500 mb-2">‡∏ó‡∏∞‡∏•‡∏∏‡∏õ‡πâ‡∏≠‡∏°‡∏¢‡∏≤‡∏° ‡∏™‡πà‡∏á‡∏ñ‡∏∂‡∏á‡∏´‡∏ô‡πâ‡∏≤‡∏ö‡πâ‡∏≤‡∏ô‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤</p>
                            
                            <!-- ‡∏õ‡πâ‡∏≤‡∏¢‡∏ö‡∏≠‡∏Å‡∏ß‡πà‡∏≤‡∏ï‡πâ‡∏≠‡∏á‡πÄ‡∏Å‡πá‡∏ö‡πÄ‡∏á‡∏¥‡∏ô‡∏™‡∏î‡πÑ‡∏´‡∏° -->
                            <div class="bg-gray-50 border border-gray-200 rounded-xl p-3" id="payment-instruction">
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- ‡∏õ‡∏∏‡πà‡∏°‡∏Å‡∏î‡∏à‡∏ö‡∏á‡∏≤‡∏ô -->
                <div class="p-4 bg-white border-t border-gray-200 shrink-0">
                    <button id="btn-complete-job" onclick="completeJob()" class="w-full bg-emerald-500 hover:bg-emerald-600 text-white font-bold py-4 rounded-xl shadow-lg active:scale-95 text-lg flex justify-center items-center gap-2 transition-all">
                        <i class="fas fa-check-circle"></i> ‡∏à‡∏±‡∏î‡∏™‡πà‡∏á‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à!
                    </button>
                </div>
            </div>

        </main>
    </div>

    <audio id="alarm-sound" preload="auto">
        <source src="https://assets.mixkit.co/active_storage/sfx/2869/2869-preview.mp3" type="audio/mpeg">
    </audio>

    <script>
        // ‚ö†Ô∏è ‡∏•‡∏¥‡∏á‡∏Å‡πå GAS (Web App URL) ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î!
        const GAS_URL = "https://script.google.com/macros/s/AKfycbwqRcQtJurJGcnV2JSE92GK3n7VfzHLhFxYj92xN9NLrh4A0Mt5OkiLn6ewn5hG7xpW/exec"; 
        const LIFF_ID = "2009194952-YLwj8qNu"; 
        
        let userProfile = null;
        let myRiderName = "";
        let isOnline = false;
        let jobInterval;
        let currentJobId = null;

        // üåü ‡∏ï‡∏±‡∏ß‡πÅ‡∏õ‡∏£‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏£‡∏∞‡∏ö‡∏ö ‡∏à‡∏≠‡∏î‡∏≥ ‡πÅ‡∏•‡∏∞ Wake Lock üåü
        let wakeLock = null;
        let idleTimer = null;
        const IDLE_TIMEOUT = 30000; // 30 ‡∏ß‡∏¥‡∏ô‡∏≤‡∏ó‡∏µ ‡∏ï‡∏±‡∏î‡πÄ‡∏Ç‡πâ‡∏≤‡∏à‡∏≠‡∏î‡∏≥ (‡∏õ‡∏£‡∏±‡∏ö‡πÄ‡∏õ‡πá‡∏ô 60000 ‡∏Ñ‡∏∑‡∏≠ 1 ‡∏ô‡∏≤‡∏ó‡∏µ‡πÑ‡∏î‡πâ)

        async function initializeLiff() {
            try {
                await liff.init({ liffId: LIFF_ID });
                if (liff.isLoggedIn()) { 
                    userProfile = await liff.getProfile(); 
                    if(userProfile.pictureUrl) document.getElementById('profile-img').src = userProfile.pictureUrl;
                    fetchJobs(); 
                } else { 
                    liff.login(); 
                }
            } catch (err) { 
                userProfile = {userId: "MOCK_RIDER_UID"}; 
                fetchJobs(); 
            }
        }
        window.onload = () => { initializeLiff(); };

        // üåü 1. ‡∏£‡∏∞‡∏ö‡∏ö Wake Lock (‡∏õ‡πâ‡∏≠‡∏á‡∏Å‡∏±‡∏ô‡∏´‡∏ô‡πâ‡∏≤‡∏à‡∏≠‡∏î‡∏±‡∏ö) üåü
        async function requestWakeLock() {
            try {
                if ('wakeLock' in navigator) {
                    wakeLock = await navigator.wakeLock.request('screen');
                    console.log('‚úÖ Wake Lock Active: ‡∏´‡∏ô‡πâ‡∏≤‡∏à‡∏≠‡∏à‡∏∞‡πÑ‡∏°‡πà‡∏î‡∏±‡∏ö‡πÅ‡∏•‡πâ‡∏ß!');
                    wakeLock.addEventListener('release', () => {
                        console.log('‚ùå Wake Lock Released');
                    });
                }
            } catch (err) {
                console.log('Wake Lock Error:', err.name, err.message);
            }
        }

        function releaseWakeLock() {
            if (wakeLock !== null) {
                wakeLock.release().then(() => { wakeLock = null; });
            }
        }

        // ‡∏Ç‡∏≠ Wake Lock ‡πÉ‡∏´‡∏°‡πà‡∏ñ‡πâ‡∏≤‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡∏™‡∏•‡∏±‡∏ö‡πÅ‡∏≠‡∏õ‡∏Å‡∏•‡∏±‡∏ö‡∏°‡∏≤
        document.addEventListener('visibilitychange', async () => {
            if (wakeLock !== null && document.visibilityState === 'visible' && isOnline) {
                requestWakeLock();
            }
        });

        // üåü 2. ‡∏£‡∏∞‡∏ö‡∏ö‡∏ô‡∏±‡∏ö‡πÄ‡∏ß‡∏•‡∏≤‡∏ñ‡∏≠‡∏¢‡∏´‡∏•‡∏±‡∏á‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡πÇ‡∏´‡∏°‡∏î "‡∏à‡∏≠‡∏î‡∏≥" üåü
        function resetIdleTimer() {
            clearTimeout(idleTimer);
            // ‡∏ñ‡πâ‡∏≤‡∏£‡∏±‡∏ö‡∏á‡∏≤‡∏ô‡∏≠‡∏¢‡∏π‡πà (Online) ‡πÅ‡∏•‡∏∞‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏ß‡∏¥‡πà‡∏á‡∏á‡∏≤‡∏ô‡∏≠‡∏¢‡∏π‡πà ‡πÉ‡∏´‡πâ‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ô‡∏±‡∏ö‡πÄ‡∏ß‡∏•‡∏≤‡πÄ‡∏Ç‡πâ‡∏≤‡∏à‡∏≠‡∏î‡∏≥
            if (isOnline && !currentJobId) {
                idleTimer = setTimeout(showDimScreen, IDLE_TIMEOUT);
            }
        }

        function showDimScreen() {
            const dimScreen = document.getElementById('dim-screen-overlay');
            dimScreen.classList.remove('hidden');
            setTimeout(() => dimScreen.classList.remove('opacity-0'), 10); // ‡∏´‡∏ô‡πà‡∏ß‡∏á‡∏ô‡∏¥‡∏î‡∏ô‡∏∂‡∏á‡πÉ‡∏´‡πâ transition ‡∏ó‡∏≥‡∏á‡∏≤‡∏ô
        }

        function wakeUpScreen() {
            const dimScreen = document.getElementById('dim-screen-overlay');
            dimScreen.classList.add('opacity-0');
            setTimeout(() => dimScreen.classList.add('hidden'), 500);
            resetIdleTimer(); // ‡∏£‡∏µ‡πÄ‡∏ã‡πá‡∏ï‡πÄ‡∏ß‡∏•‡∏≤‡∏ô‡∏±‡∏ö‡πÉ‡∏´‡∏°‡πà
        }

        // ‡∏î‡∏±‡∏Å‡∏à‡∏±‡∏ö‡∏Å‡∏≤‡∏£‡∏™‡∏±‡∏°‡∏ú‡∏±‡∏™‡∏´‡∏ô‡πâ‡∏≤‡∏à‡∏≠‡∏ó‡∏∏‡∏Å‡∏£‡∏π‡∏õ‡πÅ‡∏ö‡∏ö ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏õ‡∏•‡∏∏‡∏Å‡∏à‡∏≠‡πÅ‡∏•‡∏∞‡∏£‡∏µ‡πÄ‡∏ã‡πá‡∏ï‡πÄ‡∏ß‡∏•‡∏≤
        document.addEventListener('touchstart', resetIdleTimer);
        document.addEventListener('click', resetIdleTimer);
        document.addEventListener('mousemove', resetIdleTimer);

        // üåü ‡πÄ‡∏õ‡∏¥‡∏î/‡∏õ‡∏¥‡∏î ‡∏™‡∏ß‡∏¥‡∏ï‡∏ä‡πå‡∏Å‡∏≤‡∏£‡∏ó‡∏≥‡∏á‡∏≤‡∏ô üåü
        function toggleOnlineStatus() {
            isOnline = document.getElementById('toggle-online').checked;
            
            const header = document.getElementById('main-header'); 
            const overlay = document.getElementById('offline-overlay');
            const statusDot = document.getElementById('status-dot'); 
            const statusText = document.getElementById('status-text');
            const profileImg = document.getElementById('profile-img'); 
            const profileBorder = document.getElementById('profile-border');

            if (isOnline) {
                header.classList.replace('bg-gray-800', 'bg-amber-500'); 
                overlay.classList.add('hidden');
                statusDot.classList.replace('bg-gray-500', 'bg-green-300'); statusDot.classList.add('animate-pulse');
                statusText.innerText = "‡∏û‡∏£‡πâ‡∏≠‡∏°‡∏£‡∏±‡∏ö‡∏á‡∏≤‡∏ô"; statusText.classList.replace('text-gray-300', 'text-amber-100');
                profileImg.classList.remove('grayscale'); profileBorder.classList.replace('border-transparent', 'border-amber-200');
                
                // ‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ó‡∏≥‡∏á‡∏≤‡∏ô‡∏£‡∏∞‡∏ö‡∏ö‡∏ï‡πà‡∏≤‡∏á‡πÜ
                document.getElementById('alarm-sound').load(); // ‡πÄ‡∏ï‡∏£‡∏µ‡∏¢‡∏°‡πÄ‡∏™‡∏µ‡∏¢‡∏á
                requestWakeLock(); // ‡∏•‡πá‡∏≠‡∏Å‡∏à‡∏≠‡πÑ‡∏°‡πà‡πÉ‡∏´‡πâ‡∏î‡∏±‡∏ö
                resetIdleTimer(); // ‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ô‡∏±‡∏ö‡πÄ‡∏ß‡∏•‡∏≤‡∏à‡∏≠‡∏î‡∏≥
                fetchJobs(); // ‡∏î‡∏∂‡∏á‡∏£‡∏≠‡∏ö‡πÅ‡∏£‡∏Å
                jobInterval = setInterval(fetchJobs, 10000); // ‡∏ß‡∏ô‡∏•‡∏π‡∏õ‡∏ó‡∏∏‡∏Å 10 ‡∏ß‡∏¥‡∏ô‡∏≤‡∏ó‡∏µ

            } else {
                header.classList.replace('bg-amber-500', 'bg-gray-800'); 
                overlay.classList.remove('hidden');
                statusDot.classList.replace('bg-green-300', 'bg-gray-500'); statusDot.classList.remove('animate-pulse');
                statusText.innerText = "‡∏≠‡∏≠‡∏ü‡πÑ‡∏•‡∏ô‡πå (‡∏û‡∏±‡∏Å‡∏ú‡πà‡∏≠‡∏ô)"; statusText.classList.replace('text-amber-100', 'text-gray-300');
                profileImg.classList.add('grayscale'); profileBorder.classList.replace('border-amber-200', 'border-transparent');
                
                // ‡∏õ‡∏¥‡∏î‡∏£‡∏∞‡∏ö‡∏ö‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î
                clearInterval(jobInterval);
                clearTimeout(idleTimer);
                wakeUpScreen(); // ‡πÄ‡∏≠‡∏≤‡∏à‡∏≠‡∏î‡∏≥‡∏≠‡∏≠‡∏Å
                releaseWakeLock(); // ‡∏õ‡∏•‡πà‡∏≠‡∏¢‡πÉ‡∏´‡πâ‡∏à‡∏≠‡∏î‡∏±‡∏ö‡πÑ‡∏î‡πâ‡∏ï‡∏≤‡∏°‡∏õ‡∏Å‡∏ï‡∏¥
                document.getElementById('job-list-container').innerHTML = '';
            }
        }

        async function fetchJobs() {
            try {
                const response = await fetch(GAS_URL, { 
                    method: 'POST', 
                    body: JSON.stringify({ action: "rider_get_jobs", uid: userProfile.userId }) 
                });
                const result = await response.json();
                
                document.getElementById('liff-loading').style.display = 'none';

                if(result.status === "error") {
                    document.getElementById('error-state').classList.remove('hidden');
                    document.getElementById('app-container').classList.add('hidden');
                    if(isOnline) document.getElementById('toggle-online').click();
                    return;
                }

                document.getElementById('error-state').classList.add('hidden');
                document.getElementById('app-container').classList.remove('hidden');
                
                myRiderName = result.riderName;
                document.getElementById('rider-name').innerText = myRiderName;

                if(result.activeJob) {
                    showActiveJob(result.activeJob);
                    wakeUpScreen(); // ‡∏°‡∏µ‡∏á‡∏≤‡∏ô‡∏Ñ‡πâ‡∏≤‡∏á‡∏≠‡∏¢‡∏π‡πà ‡πÉ‡∏´‡πâ‡∏à‡∏≠‡πÅ‡∏à‡πà‡∏°‡πÄ‡∏™‡∏°‡∏≠
                    clearTimeout(idleTimer); // ‡∏õ‡∏¥‡∏î‡∏£‡∏∞‡∏ö‡∏ö‡∏à‡∏≠‡∏î‡∏≥‡πÄ‡∏ß‡∏•‡∏≤‡∏°‡∏µ‡∏á‡∏≤‡∏ô
                    return;
                } else {
                    document.getElementById('view-active-job').classList.add('hidden');
                    document.getElementById('view-active-job').classList.remove('flex');
                    document.getElementById('view-job-board').classList.remove('hidden');
                    document.getElementById('view-job-board').classList.add('flex');
                    resetIdleTimer(); // ‡∏Å‡∏•‡∏±‡∏ö‡∏°‡∏≤‡∏£‡∏≠‡∏á‡∏≤‡∏ô ‡πÉ‡∏´‡πâ‡∏ô‡∏±‡∏ö‡πÄ‡∏ß‡∏•‡∏≤‡∏à‡∏≠‡∏î‡∏≥‡∏ï‡πà‡∏≠
                }

                if(isOnline) renderJobBoard(result.jobs);

            } catch (err) { console.log("Fetch error:", err); }
        }

        let previousJobCount = 0;
        
        function renderJobBoard(jobs) {
            const container = document.getElementById('job-list-container');
            container.innerHTML = '';
            
            if(jobs.length === 0) { previousJobCount = 0; return; }

            // üåü ‡∏ó‡πà‡∏≤‡πÑ‡∏°‡πâ‡∏ï‡∏≤‡∏¢! ‡∏á‡∏≤‡∏ô‡πÄ‡∏Ç‡πâ‡∏≤‡∏õ‡∏∏‡πä‡∏ö ‡∏õ‡∏•‡∏∏‡∏Å‡∏à‡∏≠‡∏™‡∏ß‡πà‡∏≤‡∏á ‡∏û‡∏£‡πâ‡∏≠‡∏°‡πÄ‡∏™‡∏µ‡∏¢‡∏á‡πÑ‡∏ã‡πÄ‡∏£‡∏ô üåü
            if(jobs.length > previousJobCount) {
                wakeUpScreen(); // ‡πÄ‡∏î‡πâ‡∏á‡∏à‡∏≠‡∏™‡∏ß‡πà‡∏≤‡∏á‡∏ó‡∏±‡∏ô‡∏ó‡∏µ!
                
                const alarm = document.getElementById('alarm-sound');
                alarm.currentTime = 0;
                alarm.play().catch(e => console.log("Auto-play blocked"));

                // ‡∏´‡∏∏‡πà‡∏ô‡∏¢‡∏ô‡∏ï‡πå‡∏û‡∏π‡∏î‡∏ö‡∏≠‡∏Å
                if ('speechSynthesis' in window) {
                    const msg = new SpeechSynthesisUtterance("‡∏û‡∏µ‡πà‡∏ß‡∏¥‡∏ô‡∏Ñ‡∏∞ ‡∏°‡∏µ‡∏≠‡∏≠‡πÄ‡∏î‡∏≠‡∏£‡πå‡πÉ‡∏´‡∏°‡πà‡πÄ‡∏Ç‡πâ‡∏≤‡∏Ñ‡πà‡∏∞ ‡∏£‡∏µ‡∏ö‡∏Å‡∏î‡∏£‡∏±‡∏ö‡∏á‡∏≤‡∏ô‡∏ô‡∏∞‡∏Ñ‡∏∞!");
                    msg.lang = 'th-TH'; msg.rate = 1.1;
                    window.speechSynthesis.speak(msg);
                }
            }
            previousJobCount = jobs.length;

            jobs.forEach(job => {
                container.innerHTML += `
                    <div class="bg-white rounded-2xl shadow-lg border-l-4 border-amber-500 overflow-hidden relative mb-4 transform transition-all">
                        <div class="p-4 bg-amber-50/30">
                            <div class="flex justify-between items-start mb-3">
                                <div>
                                    <span class="bg-red-500 text-white text-[10px] font-bold px-2 py-0.5 rounded animate-pulse">‡∏á‡∏≤‡∏ô‡πÉ‡∏´‡∏°‡πà‡πÄ‡∏Ç‡πâ‡∏≤!</span>
                                    <p class="text-xs font-bold text-gray-800 mt-1">${job.orderId}</p>
                                </div>
                                <div class="text-right">
                                    <p class="text-[10px] text-gray-500 font-bold">‡∏Ñ‡πà‡∏≤‡∏à‡∏±‡∏î‡∏™‡πà‡∏á</p>
                                    <p class="font-bold text-2xl text-amber-500 drop-shadow-sm">${job.deliveryFee} <span class="text-sm">‡∏ø</span></p>
                                </div>
                            </div>
                            
                            <div class="relative pl-4 border-l-2 border-dashed border-gray-300 ml-2 space-y-3 mb-4 mt-2">
                                <div class="relative">
                                    <div class="absolute -left-[21px] top-0 w-4 h-4 bg-gray-800 rounded-full border-2 border-white"></div>
                                    <p class="text-[10px] font-bold text-gray-400">‡∏£‡∏±‡∏ö‡∏≠‡∏≤‡∏´‡∏≤‡∏£‡∏ó‡∏µ‡πà</p>
                                    <p class="font-bold text-sm text-gray-800">${job.shopName}</p>
                                </div>
                                <div class="relative">
                                    <div class="absolute -left-[21px] top-0 w-4 h-4 bg-emerald-500 rounded-full border-2 border-white"></div>
                                    <p class="text-[10px] font-bold text-gray-400">‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏≠‡∏≤‡∏´‡∏≤‡∏£</p>
                                    <p class="text-xs text-gray-600 line-clamp-2">${job.details}</p>
                                </div>
                            </div>
                            
                            <button onclick="acceptJob('${job.orderId}', this)" class="w-full bg-gray-800 hover:bg-gray-900 text-white font-bold py-3.5 rounded-xl shadow-md active:scale-95 text-base flex justify-center items-center gap-2">
                                <i class="fas fa-motorcycle"></i> ‡∏Å‡∏î‡∏£‡∏±‡∏ö‡∏á‡∏≤‡∏ô‡∏ô‡∏µ‡πâ‡∏ó‡∏±‡∏ô‡∏ó‡∏µ!
                            </button>
                        </div>
                    </div>`;
            });
        }

        // ‡∏õ‡∏∏‡πà‡∏°‡πÄ‡∏ó‡∏™‡∏ï‡πå‡∏£‡∏∞‡∏ö‡∏ö‡∏à‡∏≠‡∏î‡∏≥‡πÅ‡∏•‡∏∞‡πÄ‡∏™‡∏µ‡∏¢‡∏á (‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡πÇ‡∏ä‡∏ß‡πå‡∏ô‡∏≤‡∏¢‡∏ó‡∏∏‡∏ô)
        function simulateNewJob() {
            if(!isOnline) { alert("‡∏ï‡πâ‡∏≠‡∏á‡πÄ‡∏õ‡∏¥‡∏î‡∏™‡∏ß‡∏¥‡∏ï‡∏ä‡πå‡∏£‡∏±‡∏ö‡∏á‡∏≤‡∏ô‡∏Å‡πà‡∏≠‡∏ô‡∏Ñ‡πà‡∏∞"); return; }
            wakeUpScreen(); // ‡∏õ‡∏•‡∏∏‡∏Å‡∏à‡∏≠‡∏™‡∏ß‡πà‡∏≤‡∏á
            const alarm = document.getElementById('alarm-sound');
            alarm.currentTime = 0; alarm.play();
            if ('speechSynthesis' in window) {
                const msg = new SpeechSynthesisUtterance("‡∏û‡∏µ‡πà‡∏™‡∏°‡∏´‡∏°‡∏≤‡∏¢‡∏Ñ‡∏∞ ‡∏°‡∏µ‡∏á‡∏≤‡∏ô‡∏î‡πà‡∏ß‡∏ô‡πÄ‡∏Ç‡πâ‡∏≤‡∏°‡∏≤‡πÉ‡∏´‡∏°‡πà‡∏Ñ‡πà‡∏∞ ‡πÑ‡∏î‡πâ‡∏Ñ‡πà‡∏≤‡∏™‡πà‡∏á ‡∏™‡∏¥‡∏ö‡∏´‡πâ‡∏≤‡∏ö‡∏≤‡∏ó ‡∏£‡∏µ‡∏ö‡∏Å‡∏î‡∏£‡∏±‡∏ö‡∏á‡∏≤‡∏ô‡πÄ‡∏•‡∏¢‡∏Ñ‡πà‡∏∞!");
                msg.lang = 'th-TH'; window.speechSynthesis.speak(msg);
            }
        }

        async function acceptJob(orderId, btn) {
            const alarm = document.getElementById('alarm-sound');
            alarm.pause(); alarm.currentTime = 0; // ‡∏õ‡∏¥‡∏î‡πÄ‡∏™‡∏µ‡∏¢‡∏á‡πÑ‡∏ã‡πÄ‡∏£‡∏ô
            if ('speechSynthesis' in window) window.speechSynthesis.cancel(); // ‡∏´‡∏¢‡∏∏‡∏î‡∏´‡∏∏‡πà‡∏ô‡∏¢‡∏ô‡∏ï‡πå‡∏û‡∏π‡∏î

            const originalText = btn.innerHTML; 
            btn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÅ‡∏¢‡πà‡∏á‡∏á‡∏≤‡∏ô...'; 
            btn.disabled = true; btn.classList.add('opacity-70');
            
            try {
                const response = await fetch(GAS_URL, { 
                    method: 'POST', body: JSON.stringify({ action: "rider_accept_job", orderId: orderId, riderName: myRiderName }) 
                });
                const result = await response.json();
                
                if(result.status === "success") { fetchJobs(); } 
                else { alert(result.message); fetchJobs(); } 
            } catch (err) { 
                alert('‡πÄ‡∏Ñ‡∏£‡∏∑‡∏≠‡∏Ç‡πà‡∏≤‡∏¢‡∏Ç‡∏±‡∏î‡∏Ç‡πâ‡∏≠‡∏á ‡∏•‡∏≠‡∏á‡∏Å‡∏î‡∏£‡∏±‡∏ö‡∏á‡∏≤‡∏ô‡πÉ‡∏´‡∏°‡πà‡∏ô‡∏∞‡∏Ñ‡∏∞');
                btn.innerHTML = originalText; btn.disabled = false; btn.classList.remove('opacity-70');
            }
        }

        function showActiveJob(job) {
            currentJobId = job.orderId;
            document.getElementById('view-job-board').classList.add('hidden');
            document.getElementById('view-job-board').classList.remove('flex');
            document.getElementById('view-active-job').classList.remove('hidden');
            document.getElementById('view-active-job').classList.add('flex');

            document.getElementById('active-order-id').innerText = job.orderId;
            document.getElementById('active-shop-name').innerText = job.shopName;
            document.getElementById('active-delivery-fee').innerText = job.deliveryFee;

            const instruction = document.getElementById('payment-instruction');
            if(job.payMethod === "COD") {
                instruction.innerHTML = `
                    <div class="flex items-start gap-2">
                        <i class="fas fa-money-bill-wave text-red-500 mt-1"></i>
                        <div>
                            <p class="text-[11px] font-bold text-red-500 mb-0.5">!! ‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏à‡πà‡∏≤‡∏¢‡πÄ‡∏á‡∏¥‡∏ô‡∏™‡∏î !!</p>
                            <p class="text-xs text-gray-800">‡πÄ‡∏Å‡πá‡∏ö‡πÄ‡∏á‡∏¥‡∏ô‡∏™‡∏î‡∏à‡∏≤‡∏Å‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤ <span class="font-bold text-red-600 text-lg">${job.netTotal} ‡∏ø</span></p>
                            <p class="text-[10px] text-gray-500 mt-1">(‡∏´‡∏±‡∏Å‡∏Ñ‡πà‡∏≤‡∏™‡πà‡∏á‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì‡πÑ‡∏ß‡πâ ‡πÅ‡∏•‡∏∞‡πÇ‡∏≠‡∏ô‡∏Ñ‡∏∑‡∏ô‡∏£‡πâ‡∏≤‡∏ô‡∏Ñ‡πâ‡∏≤)</p>
                        </div>
                    </div>`;
                instruction.classList.replace('bg-gray-50', 'bg-red-50');
            } else {
                instruction.innerHTML = `
                    <div class="flex items-start gap-2">
                        <i class="fas fa-check-circle text-emerald-500 mt-1"></i>
                        <div>
                            <p class="text-[11px] font-bold text-emerald-600 mb-0.5">‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤‡πÇ‡∏≠‡∏ô‡πÄ‡∏á‡∏¥‡∏ô‡∏ú‡πà‡∏≤‡∏ô‡∏£‡∏∞‡∏ö‡∏ö‡πÅ‡∏•‡πâ‡∏ß</p>
                            <p class="text-xs text-gray-800 font-medium">‡∏™‡πà‡∏á‡∏≠‡∏≤‡∏´‡∏≤‡∏£‡πÉ‡∏´‡πâ‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤‡πÑ‡∏î‡πâ‡πÄ‡∏•‡∏¢ <span class="text-emerald-500 font-bold">‡πÑ‡∏°‡πà‡∏ï‡πâ‡∏≠‡∏á‡πÄ‡∏Å‡πá‡∏ö‡πÄ‡∏á‡∏¥‡∏ô‡πÄ‡∏û‡∏¥‡πà‡∏°</span></p>
                            <p class="text-[10px] text-gray-500 mt-1">(‡∏£‡πâ‡∏≤‡∏ô‡∏Ñ‡πâ‡∏≤‡∏à‡∏∞‡πÇ‡∏≠‡∏ô‡∏Ñ‡πà‡∏≤‡∏™‡πà‡∏á ${job.deliveryFee} ‡∏ø ‡πÉ‡∏´‡πâ‡∏Ñ‡∏∏‡∏ì)</p>
                        </div>
                    </div>`;
                instruction.classList.replace('bg-red-50', 'bg-emerald-50');
            }
        }

        async function completeJob() {
            if(!confirm("‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢! ‡∏Ñ‡∏∏‡∏ì‡∏™‡πà‡∏á‡∏≠‡∏≤‡∏´‡∏≤‡∏£‡πÉ‡∏´‡πâ‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤‡πÄ‡∏™‡∏£‡πá‡∏à‡πÅ‡∏•‡πâ‡∏ß‡πÉ‡∏ä‡πà‡πÑ‡∏´‡∏°‡∏Ñ‡∏∞?")) return;
            
            const btn = document.getElementById('btn-complete-job'); 
            const originalText = btn.innerHTML;
            btn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏õ‡∏¥‡∏î‡∏á‡∏≤‡∏ô...'; 
            btn.disabled = true; btn.classList.replace('bg-emerald-500', 'bg-gray-400');
            
            try {
                const response = await fetch(GAS_URL, { 
                    method: 'POST', body: JSON.stringify({ action: "rider_complete_job", orderId: currentJobId }) 
                });
                const result = await response.json();
                
                if(result.status === "success") { 
                    alert("‡∏õ‡∏¥‡∏î‡∏á‡∏≤‡∏ô‡∏™‡∏ß‡∏¢‡∏á‡∏≤‡∏°! ‡πÄ‡∏¢‡∏µ‡πà‡∏¢‡∏°‡∏°‡∏≤‡∏Å‡∏Ñ‡πà‡∏∞‡∏û‡∏µ‡πà‡∏ß‡∏¥‡∏ô! üëè"); 
                    currentJobId = null; // ‡πÄ‡∏Ñ‡∏•‡∏µ‡∏¢‡∏£‡πå‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏á‡∏≤‡∏ô‡∏Ñ‡πâ‡∏≤‡∏á
                    fetchJobs(); 
                } else { alert("‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏Ñ‡πà‡∏∞"); }
            } catch (err) { 
                alert('‡∏£‡∏∞‡∏ö‡∏ö‡∏Ç‡∏±‡∏î‡∏Ç‡πâ‡∏≠‡∏á ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏•‡∏≠‡∏á‡∏Å‡∏î‡∏≠‡∏µ‡∏Å‡∏Ñ‡∏£‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏∞'); 
            } finally { 
                btn.innerHTML = originalText; btn.disabled = false; btn.classList.replace('bg-gray-400', 'bg-emerald-500');
            }
        }
    </script>
</body>
</html>
