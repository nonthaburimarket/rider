<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>‡πÑ‡∏£‡πÄ‡∏î‡∏≠‡∏£‡πå - ‡∏ä‡∏∏‡∏°‡∏ä‡∏ô Delivery</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://static.line-scdn.net/liff/edge/2/sdk.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Prompt:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Prompt', sans-serif; background-color: #f3f4f6; }
        .hide-scrollbar::-webkit-scrollbar { display: none; }
        .hide-scrollbar { -ms-overflow-style: none; scrollbar-width: none; }
        
        /* ‡πÄ‡∏≠‡∏ü‡πÄ‡∏ü‡∏Å‡∏ï‡πå‡πÄ‡∏£‡∏î‡∏≤‡∏£‡πå‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡∏á‡∏≤‡∏ô */
        @keyframes radar { 0% { transform: scale(0.5); opacity: 0.8; } 100% { transform: scale(2); opacity: 0; } }
        .radar-ping::after {
            content: ''; position: absolute; width: 100%; height: 100%;
            background-color: #f59e0b; border-radius: 50%; top: 0; left: 0;
            z-index: -1; animation: radar 2s infinite ease-out;
        }
        /* ‡∏™‡∏ß‡∏¥‡∏ï‡∏ä‡πå‡πÄ‡∏õ‡∏¥‡∏î-‡∏õ‡∏¥‡∏î‡∏£‡∏±‡∏ö‡∏á‡∏≤‡∏ô */
        .toggle-checkbox:checked { right: 0; border-color: #10b981; }
        .toggle-checkbox:checked + .toggle-label { background-color: #10b981; }
    </style>
</head>
<body class="text-gray-800 antialiased h-screen flex flex-col overflow-hidden">

    <!-- ‡∏´‡∏ô‡πâ‡∏≤‡∏à‡∏≠‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô -->
    <div id="liff-loading" class="fixed inset-0 bg-white z-50 flex flex-col items-center justify-center">
        <i class="fas fa-motorcycle text-5xl text-amber-500 mb-4 animate-bounce"></i>
        <h2 class="font-bold text-xl text-gray-800">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡∏£‡∏∞‡∏ö‡∏ö‡πÑ‡∏£‡πÄ‡∏î‡∏≠‡∏£‡πå...</h2>
    </div>

    <!-- ‡∏´‡∏ô‡πâ‡∏≤‡∏à‡∏≠‡πÅ‡∏™‡∏î‡∏á Error (‡πÄ‡∏ä‡πà‡∏ô ‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡∏£‡∏±‡∏ö‡∏Å‡∏≤‡∏£‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥) -->
    <div id="error-state" class="hidden h-full flex flex-col items-center justify-center p-6 text-center bg-white">
        <i class="fas fa-id-card text-6xl text-red-500 mb-4"></i>
        <h2 class="font-bold text-xl text-gray-800 mb-2">‡∏ö‡∏±‡∏ç‡∏ä‡∏µ‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏û‡∏£‡πâ‡∏≠‡∏°‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô</h2>
        <p class="text-sm text-gray-500" id="error-message">‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏™‡∏°‡∏±‡∏Ñ‡∏£‡πÄ‡∏õ‡πá‡∏ô‡πÑ‡∏£‡πÄ‡∏î‡∏≠‡∏£‡πå‡∏ú‡πà‡∏≤‡∏ô‡∏´‡∏ô‡πâ‡∏≤‡πÅ‡∏≠‡∏õ‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤ ‡∏´‡∏£‡∏∑‡∏≠‡∏£‡∏≠‡πÅ‡∏≠‡∏î‡∏°‡∏¥‡∏ô‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥‡∏ö‡∏±‡∏ç‡∏ä‡∏µ‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì‡∏Å‡πà‡∏≠‡∏ô‡∏ô‡∏∞‡∏Ñ‡∏∞</p>
    </div>

    <!-- ‡∏ï‡∏±‡∏ß‡πÅ‡∏≠‡∏õ‡∏´‡∏•‡∏±‡∏Å -->
    <div id="app-container" class="hidden max-w-md w-full mx-auto bg-gray-50 h-full relative flex flex-col shadow-2xl">
        
        <!-- HEADER (‡∏à‡∏∞‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏™‡∏µ‡∏ï‡∏≤‡∏°‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞ ‡πÄ‡∏õ‡∏¥‡∏î/‡∏õ‡∏¥‡∏î ‡∏£‡∏±‡∏ö‡∏á‡∏≤‡∏ô) -->
        <header class="bg-gray-800 text-white p-4 shadow-md z-20 flex justify-between items-center shrink-0 transition-colors duration-300" id="main-header">
            <div class="flex items-center gap-3">
                <div class="w-10 h-10 bg-white rounded-full flex items-center justify-center overflow-hidden border-2 border-transparent p-0.5" id="profile-border">
                    <img src="https://api.dicebear.com/7.x/avataaars/svg?seed=Rider" class="w-full h-full bg-gray-100 rounded-full grayscale transition-all duration-300" id="profile-img">
                </div>
                <div>
                    <h1 class="font-bold text-sm" id="rider-name">‡πÇ‡∏´‡∏•‡∏î‡∏ä‡∏∑‡πà‡∏≠...</h1>
                    <div class="flex items-center gap-1">
                        <div class="w-2 h-2 bg-gray-500 rounded-full" id="status-dot"></div>
                        <p class="text-[10px] text-gray-300 font-medium" id="status-text">‡∏≠‡∏≠‡∏ü‡πÑ‡∏•‡∏ô‡πå (‡∏û‡∏±‡∏Å‡∏ú‡πà‡∏≠‡∏ô)</p>
                    </div>
                </div>
            </div>
            
            <!-- ‡∏™‡∏ß‡∏¥‡∏ï‡∏ä‡πå ‡πÄ‡∏õ‡∏¥‡∏î-‡∏õ‡∏¥‡∏î ‡∏£‡∏±‡∏ö‡∏á‡∏≤‡∏ô -->
            <div class="flex flex-col items-end">
                <div class="relative inline-block w-12 align-middle select-none transition duration-200 ease-in mb-1">
                    <input type="checkbox" id="toggle-online" class="toggle-checkbox absolute block w-6 h-6 rounded-full bg-white border-4 appearance-none cursor-pointer transition-all duration-300" onchange="toggleOnlineStatus()"/>
                    <label for="toggle-online" class="toggle-label block overflow-hidden h-6 rounded-full bg-gray-400 cursor-pointer transition-colors duration-300"></label>
                </div>
                <p class="text-[9px] text-gray-300 font-bold">‡∏™‡∏ß‡∏¥‡∏ï‡∏ä‡πå‡∏£‡∏±‡∏ö‡∏á‡∏≤‡∏ô</p>
            </div>
        </header>

        <!-- MAIN CONTENT AREA -->
        <main class="flex-1 overflow-y-auto relative">
            
            <!-- üåü ‡∏´‡∏ô‡πâ‡∏≤‡∏à‡∏≠ 1: ‡∏Å‡∏£‡∏∞‡∏î‡∏≤‡∏ô‡∏£‡∏≠‡∏á‡∏≤‡∏ô (‡∏™‡πÅ‡∏Å‡∏ô‡πÄ‡∏£‡∏î‡∏≤‡∏£‡πå) üåü -->
            <div id="view-job-board" class="flex flex-col h-full relative">
                
                <!-- ‡∏°‡πà‡∏≤‡∏ô‡∏ö‡∏±‡∏á‡∏ï‡∏≠‡∏ô‡∏≠‡∏≠‡∏ü‡πÑ‡∏•‡∏ô‡πå -->
                <div id="offline-overlay" class="absolute inset-0 bg-white/80 backdrop-blur-sm z-10 flex flex-col items-center justify-center text-center p-6 transition-all duration-300">
                    <i class="fas fa-bed text-6xl text-gray-300 mb-4"></i>
                    <h2 class="text-xl font-bold text-gray-600 mb-2">‡∏Ñ‡∏∏‡∏ì‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏≠‡∏≠‡∏ü‡πÑ‡∏•‡∏ô‡πå</h2>
                    <p class="text-sm text-gray-500">‡πÄ‡∏õ‡∏¥‡∏î‡∏™‡∏ß‡∏¥‡∏ï‡∏ä‡πå‡∏°‡∏∏‡∏°‡∏Ç‡∏ß‡∏≤‡∏ö‡∏ô‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏™‡πÅ‡∏Å‡∏ô‡∏´‡∏≤‡∏á‡∏≤‡∏ô<br>‡∏£‡∏∞‡∏ö‡∏ö‡∏à‡∏∞‡∏î‡∏∂‡∏á‡∏á‡∏≤‡∏ô‡∏ó‡∏µ‡πà‡∏£‡πâ‡∏≤‡∏ô‡∏ó‡∏≥‡πÄ‡∏™‡∏£‡πá‡∏à‡πÅ‡∏•‡πâ‡∏ß‡∏°‡∏≤‡πÅ‡∏™‡∏î‡∏á‡∏ó‡∏µ‡πà‡∏ô‡∏µ‡πà‡∏Ñ‡πà‡∏∞</p>
                </div>

                <!-- ‡πÄ‡∏£‡∏î‡∏≤‡∏£‡πå‡∏™‡πÅ‡∏Å‡∏ô‡∏´‡∏≤‡∏á‡∏≤‡∏ô -->
                <div class="bg-white p-4 flex flex-col items-center justify-center border-b border-gray-200 shrink-0 h-32 relative overflow-hidden">
                    <div class="absolute inset-0 opacity-5" style="background-image: radial-gradient(#f59e0b 1px, transparent 1px); background-size: 10px 10px;"></div>
                    <div class="w-10 h-10 bg-amber-500 text-white rounded-full flex items-center justify-center text-lg mb-2 relative radar-ping shadow-lg shadow-amber-500/50">
                        <i class="fas fa-satellite-dish"></i>
                    </div>
                    <p class="text-sm font-bold text-amber-600 mb-1">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡∏á‡∏≤‡∏ô...</p>
                    <p class="text-[10px] text-gray-400">‡∏£‡∏∞‡∏ö‡∏ö‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥‡∏ó‡∏∏‡∏Å‡πÜ 10 ‡∏ß‡∏¥‡∏ô‡∏≤‡∏ó‡∏µ</p>
                </div>

                <!-- ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏á‡∏≤‡∏ô‡∏ó‡∏µ‡πà‡πÄ‡∏î‡πâ‡∏á‡πÄ‡∏Ç‡πâ‡∏≤‡∏°‡∏≤ -->
                <div class="p-4 space-y-4" id="job-list-container">
                    <!-- ‡πÇ‡∏Ñ‡πâ‡∏î‡∏à‡∏∞‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏Å‡∏≤‡∏£‡πå‡∏î‡∏á‡∏≤‡∏ô‡∏°‡∏≤‡πÉ‡∏™‡πà‡∏ï‡∏£‡∏á‡∏ô‡∏µ‡πâ -->
                </div>
            </div>

            <!-- üåü ‡∏´‡∏ô‡πâ‡∏≤‡∏à‡∏≠ 2: ‡∏á‡∏≤‡∏ô‡∏ó‡∏µ‡πà‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏ß‡∏¥‡πà‡∏á‡∏≠‡∏¢‡∏π‡πà (Active Job) üåü -->
            <div id="view-active-job" class="hidden flex-col h-full bg-white">
                <div class="bg-amber-50 p-3 border-b border-amber-100 flex justify-between items-center px-4 shrink-0">
                    <span class="font-bold text-amber-700 text-sm"><i class="fas fa-motorcycle mr-1"></i> ‡∏á‡∏≤‡∏ô‡∏ó‡∏µ‡πà‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏Å‡∏≤‡∏£</span>
                    <span class="text-xs text-amber-600 font-bold" id="active-order-id">#...</span>
                </div>

                <div class="flex-1 overflow-y-auto p-4">
                    <div class="border-l-2 border-dashed border-gray-300 ml-3 pl-6 relative space-y-6">
                        
                        <!-- ‡∏à‡∏∏‡∏î‡∏ó‡∏µ‡πà 1: ‡∏£‡∏±‡∏ö‡∏≠‡∏≤‡∏´‡∏≤‡∏£‡∏ó‡∏µ‡πà‡∏£‡πâ‡∏≤‡∏ô -->
                        <div class="relative">
                            <div class="absolute -left-[33px] top-0 w-6 h-6 bg-gray-800 rounded-full border-2 border-white flex items-center justify-center text-white text-[10px]"><i class="fas fa-store"></i></div>
                            <h2 class="font-bold text-lg text-gray-800 mb-1" id="active-shop-name">‡∏£‡πâ‡∏≤‡∏ô...</h2>
                            <p class="text-xs text-gray-500 mb-2">‡πÄ‡∏Ç‡πâ‡∏≤‡πÑ‡∏õ‡∏£‡∏±‡∏ö‡∏≠‡∏≤‡∏´‡∏≤‡∏£‡∏ó‡∏µ‡πà‡∏£‡πâ‡∏≤‡∏ô‡∏ô‡∏µ‡πâ (‡∏ö‡∏≠‡∏Å‡∏£‡∏´‡∏±‡∏™‡∏≠‡∏≠‡πÄ‡∏î‡∏≠‡∏£‡πå‡∏Å‡∏±‡∏ö‡∏£‡πâ‡∏≤‡∏ô)</p>
                            
                            <div class="bg-amber-50 border border-amber-200 rounded-xl p-3 mb-2 shadow-sm">
                                <p class="text-[10px] font-bold text-amber-600 mb-1">‡∏Ñ‡∏∏‡∏ì‡∏à‡∏∞‡πÑ‡∏î‡πâ‡∏Ñ‡πà‡∏≤‡∏™‡πà‡∏á‡∏à‡∏≤‡∏Å‡∏£‡πâ‡∏≤‡∏ô</p>
                                <p class="text-xl font-bold text-gray-800"><span id="active-delivery-fee">0</span> ‡∏ø</p>
                            </div>
                        </div>

                        <!-- ‡∏à‡∏∏‡∏î‡∏ó‡∏µ‡πà 2: ‡∏™‡πà‡∏á‡∏≠‡∏≤‡∏´‡∏≤‡∏£‡πÉ‡∏´‡πâ‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤ -->
                        <div class="relative">
                            <div class="absolute -left-[33px] top-0 w-6 h-6 bg-emerald-500 rounded-full border-2 border-white flex items-center justify-center text-white text-[10px]"><i class="fas fa-home"></i></div>
                            <h2 class="font-bold text-lg text-gray-800 mb-1">‡∏™‡πà‡∏á‡πÉ‡∏´‡πâ‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤‡∏ó‡∏µ‡πà‡∏ö‡πâ‡∏≤‡∏ô</h2>
                            <p class="text-xs text-gray-500 mb-2">‡∏ó‡∏∞‡∏•‡∏∏‡∏õ‡πâ‡∏≠‡∏°‡∏¢‡∏≤‡∏° ‡∏™‡πà‡∏á‡∏ñ‡∏∂‡∏á‡∏´‡∏ô‡πâ‡∏≤‡∏ö‡πâ‡∏≤‡∏ô‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤</p>
                            
                            <!-- ‡∏õ‡πâ‡∏≤‡∏¢‡∏ö‡∏≠‡∏Å‡∏ß‡πà‡∏≤‡∏ï‡πâ‡∏≠‡∏á‡πÄ‡∏Å‡πá‡∏ö‡πÄ‡∏á‡∏¥‡∏ô‡∏™‡∏î‡πÑ‡∏´‡∏° -->
                            <div class="bg-gray-50 border border-gray-200 rounded-xl p-3" id="payment-instruction">
                                <!-- ‡πÇ‡∏Ñ‡πâ‡∏î‡∏à‡∏∞‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏°‡∏≤‡πÉ‡∏™‡πà‡∏ï‡∏£‡∏á‡∏ô‡∏µ‡πâ -->
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- ‡∏õ‡∏∏‡πà‡∏°‡∏Å‡∏î‡∏à‡∏ö‡∏á‡∏≤‡∏ô -->
                <div class="p-4 bg-white border-t border-gray-200 shrink-0">
                    <button id="btn-complete-job" onclick="completeJob()" class="w-full bg-emerald-500 hover:bg-emerald-600 text-white font-bold py-4 rounded-xl shadow-lg active:scale-95 text-lg flex justify-center items-center gap-2 transition-all">
                        <i class="fas fa-check-circle"></i> ‡∏à‡∏±‡∏î‡∏™‡πà‡∏á‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à!
                    </button>
                </div>
            </div>

        </main>
    </div>

    <!-- ‡πÑ‡∏ü‡∏•‡πå‡πÄ‡∏™‡∏µ‡∏¢‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô‡πÄ‡∏ß‡∏•‡∏≤‡∏°‡∏µ‡∏á‡∏≤‡∏ô‡πÄ‡∏Ç‡πâ‡∏≤ (‡∏ã‡πà‡∏≠‡∏ô‡πÑ‡∏ß‡πâ) -->
    <audio id="alarm-sound" preload="auto">
        <source src="https://assets.mixkit.co/active_storage/sfx/2869/2869-preview.mp3" type="audio/mpeg">
    </audio>

    <script>
        // ‚ö†Ô∏è ‡∏™‡∏≥‡∏Ñ‡∏±‡∏ç‡∏°‡∏≤‡∏Å: ‡πÄ‡∏≠‡∏≤‡∏•‡∏¥‡∏á‡∏Å‡πå GAS (Web App URL) ‡∏Ç‡∏≠‡∏á‡∏û‡∏µ‡πà‡∏ì‡∏∞‡∏°‡∏≤‡πÉ‡∏™‡πà‡∏ï‡∏£‡∏á‡∏ô‡∏µ‡πâ‡∏ô‡∏∞‡∏Ñ‡∏∞!
        const GAS_URL = "https://script.google.com/macros/s/AKfycbwtl2UN6uKKGQuyULSWR2wlzyhyFC34jtON2c_hN6Hx1R1nnOztFBcg9TM3Ze_4T0Gz/exec"; 
        
        const LIFF_ID = "2009194952-YLwj8qNu"; 
        
        let userProfile = null;
        let myRiderName = "";
        let isOnline = false;
        let jobInterval;
        let currentJobId = null;

        // ‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô‡∏Å‡∏≤‡∏£‡∏ó‡∏≥‡∏á‡∏≤‡∏ô‡∏Ç‡∏≠‡∏á LIFF
        async function initializeLiff() {
            try {
                await liff.init({ liffId: LIFF_ID });
                if (liff.isLoggedIn()) { 
                    userProfile = await liff.getProfile(); 
                    if(userProfile.pictureUrl) document.getElementById('profile-img').src = userProfile.pictureUrl;
                    fetchJobs(); // ‡πÇ‡∏´‡∏•‡∏î‡πÄ‡∏ä‡πá‡∏Ñ‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏ö‡∏±‡∏ç‡∏ä‡∏µ‡∏Ñ‡∏£‡∏±‡πâ‡∏á‡πÅ‡∏£‡∏Å‡πÄ‡∏•‡∏¢
                } else { 
                    liff.login(); 
                }
            } catch (err) { 
                console.log("LIFF Error, Using Mock Profile");
                userProfile = {userId: "MOCK_RIDER_UID"}; // ‡πÇ‡∏´‡∏°‡∏î‡∏à‡∏≥‡∏•‡∏≠‡∏á‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡πÄ‡∏ó‡∏™‡∏ï‡πå‡∏ö‡∏ô‡∏Ñ‡∏≠‡∏°
                fetchJobs(); 
            }
        }
        
        window.onload = () => { initializeLiff(); };

        // ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏™‡∏ß‡∏¥‡∏ï‡∏ä‡πå ‡πÄ‡∏õ‡∏¥‡∏î/‡∏õ‡∏¥‡∏î ‡∏Å‡∏≤‡∏£‡∏£‡∏±‡∏ö‡∏á‡∏≤‡∏ô
        function toggleOnlineStatus() {
            isOnline = document.getElementById('toggle-online').checked;
            
            const header = document.getElementById('main-header'); 
            const overlay = document.getElementById('offline-overlay');
            const statusDot = document.getElementById('status-dot'); 
            const statusText = document.getElementById('status-text');
            const profileImg = document.getElementById('profile-img'); 
            const profileBorder = document.getElementById('profile-border');

            if (isOnline) {
                // ‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô UI ‡πÄ‡∏õ‡πá‡∏ô‡πÇ‡∏´‡∏°‡∏î‡∏û‡∏£‡πâ‡∏≠‡∏°‡∏£‡∏±‡∏ö‡∏á‡∏≤‡∏ô (‡∏™‡∏µ‡πÄ‡∏Ç‡∏µ‡∏¢‡∏ß/‡∏™‡πâ‡∏°)
                header.classList.replace('bg-gray-800', 'bg-amber-500'); 
                overlay.classList.add('hidden');
                statusDot.classList.replace('bg-gray-500', 'bg-green-300'); 
                statusDot.classList.add('animate-pulse');
                statusText.innerText = "‡∏û‡∏£‡πâ‡∏≠‡∏°‡∏£‡∏±‡∏ö‡∏á‡∏≤‡∏ô"; 
                statusText.classList.replace('text-gray-300', 'text-amber-100');
                profileImg.classList.remove('grayscale'); 
                profileBorder.classList.replace('border-transparent', 'border-amber-200');
                
                // ‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏£‡∏∞‡∏ö‡∏ö‡∏™‡πÅ‡∏Å‡∏ô‡∏´‡∏≤‡∏á‡∏≤‡∏ô
                fetchJobs(); // ‡∏î‡∏∂‡∏á‡∏£‡∏≠‡∏ö‡πÅ‡∏£‡∏Å‡∏ó‡∏±‡∏ô‡∏ó‡∏µ
                jobInterval = setInterval(fetchJobs, 10000); // ‡∏ï‡∏±‡πâ‡∏á‡πÄ‡∏ß‡∏•‡∏≤‡∏î‡∏∂‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ã‡πâ‡∏≥‡∏ó‡∏∏‡∏Å 10 ‡∏ß‡∏¥‡∏ô‡∏≤‡∏ó‡∏µ
            } else {
                // ‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô UI ‡πÄ‡∏õ‡πá‡∏ô‡πÇ‡∏´‡∏°‡∏î‡∏û‡∏±‡∏Å‡∏ú‡πà‡∏≠‡∏ô (‡∏™‡∏µ‡πÄ‡∏ó‡∏≤)
                header.classList.replace('bg-amber-500', 'bg-gray-800'); 
                overlay.classList.remove('hidden');
                statusDot.classList.replace('bg-green-300', 'bg-gray-500'); 
                statusDot.classList.remove('animate-pulse');
                statusText.innerText = "‡∏≠‡∏≠‡∏ü‡πÑ‡∏•‡∏ô‡πå (‡∏û‡∏±‡∏Å‡∏ú‡πà‡∏≠‡∏ô)"; 
                statusText.classList.replace('text-amber-100', 'text-gray-300');
                profileImg.classList.add('grayscale'); 
                profileBorder.classList.replace('border-amber-200', 'border-transparent');
                
                // ‡∏õ‡∏¥‡∏î‡∏£‡∏∞‡∏ö‡∏ö‡∏™‡πÅ‡∏Å‡∏ô
                clearInterval(jobInterval);
                document.getElementById('job-list-container').innerHTML = '';
            }
        }

        // ‡∏î‡∏∂‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏á‡∏≤‡∏ô‡∏à‡∏≤‡∏Å‡∏ê‡∏≤‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• (‡∏™‡∏°‡∏≠‡∏á‡∏Å‡∏• GAS)
        async function fetchJobs() {
            try {
                const response = await fetch(GAS_URL, { 
                    method: 'POST', 
                    body: JSON.stringify({ action: "rider_get_jobs", uid: userProfile.userId }) 
                });
                const result = await response.json();
                
                document.getElementById('liff-loading').style.display = 'none';

                // ‡∏ñ‡πâ‡∏≤‡∏ö‡∏±‡∏ç‡∏ä‡∏µ‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏ú‡πà‡∏≤‡∏ô‡∏Å‡∏≤‡∏£‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥
                if(result.status === "error") {
                    document.getElementById('error-state').classList.remove('hidden');
                    document.getElementById('app-container').classList.add('hidden');
                    if(isOnline) document.getElementById('toggle-online').click(); // ‡∏ö‡∏±‡∏á‡∏Ñ‡∏±‡∏ö‡∏õ‡∏¥‡∏î‡∏™‡∏ß‡∏¥‡∏ï‡∏ä‡πå
                    return;
                }

                // ‡∏ñ‡πâ‡∏≤‡∏ö‡∏±‡∏ç‡∏ä‡∏µ‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡πÑ‡∏î‡πâ
                document.getElementById('error-state').classList.add('hidden');
                document.getElementById('app-container').classList.remove('hidden');
                
                myRiderName = result.riderName;
                document.getElementById('rider-name').innerText = myRiderName;

                // ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏ß‡πà‡∏≤‡πÑ‡∏£‡πÄ‡∏î‡∏≠‡∏£‡πå‡∏Ñ‡∏ô‡∏ô‡∏µ‡πâ ‡∏°‡∏µ "‡∏á‡∏≤‡∏ô‡∏ó‡∏µ‡πà‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏ß‡∏¥‡πà‡∏á‡∏≠‡∏¢‡∏π‡πà (‡πÅ‡∏ï‡πà‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏à‡∏ö)" ‡πÑ‡∏´‡∏°?
                if(result.activeJob) {
                    showActiveJob(result.activeJob);
                    return;
                } else {
                    // ‡∏ñ‡πâ‡∏≤‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏á‡∏≤‡∏ô‡∏Ñ‡πâ‡∏≤‡∏á ‡πÉ‡∏´‡πâ‡πÇ‡∏ä‡∏ß‡πå‡∏´‡∏ô‡πâ‡∏≤‡∏Å‡∏£‡∏∞‡∏î‡∏≤‡∏ô‡πÄ‡∏£‡∏î‡∏≤‡∏£‡πå
                    document.getElementById('view-active-job').classList.add('hidden');
                    document.getElementById('view-active-job').classList.remove('flex');
                    document.getElementById('view-job-board').classList.remove('hidden');
                    document.getElementById('view-job-board').classList.add('flex');
                }

                // ‡πÅ‡∏£‡∏ô‡πÄ‡∏î‡∏≠‡∏£‡πå‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏á‡∏≤‡∏ô‡πÉ‡∏´‡∏°‡πà‡∏ö‡∏ô‡∏Å‡∏£‡∏∞‡∏î‡∏≤‡∏ô (‡πÄ‡∏â‡∏û‡∏≤‡∏∞‡∏ï‡∏≠‡∏ô‡πÄ‡∏õ‡∏¥‡∏î‡∏™‡∏ß‡∏¥‡∏ï‡∏ä‡πå Online)
                if(isOnline) renderJobBoard(result.jobs);

            } catch (err) { console.log("Error fetching jobs:", err); }
        }

        let previousJobCount = 0;
        
        // ‡∏ß‡∏≤‡∏î‡∏Å‡∏≤‡∏£‡πå‡∏î‡∏á‡∏≤‡∏ô‡∏•‡∏á‡∏ö‡∏ô‡∏Å‡∏£‡∏∞‡∏î‡∏≤‡∏ô
        function renderJobBoard(jobs) {
            const container = document.getElementById('job-list-container');
            container.innerHTML = '';
            
            if(jobs.length === 0) { previousJobCount = 0; return; }

            // üåü ‡πÄ‡∏•‡πà‡∏ô‡πÄ‡∏™‡∏µ‡∏¢‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô‡∏ó‡∏±‡∏ô‡∏ó‡∏µ ‡∏ñ‡πâ‡∏≤‡∏°‡∏µ‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏á‡∏≤‡∏ô "‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏Ç‡∏∂‡πâ‡∏ô" ‡∏à‡∏≤‡∏Å‡∏£‡∏≠‡∏ö‡∏ó‡∏µ‡πà‡πÅ‡∏•‡πâ‡∏ß! üåü
            if(jobs.length > previousJobCount) {
                const alarm = document.getElementById('alarm-sound');
                alarm.currentTime = 0;
                alarm.play().catch(e => console.log("Auto-play blocked by browser"));
            }
            previousJobCount = jobs.length;

            jobs.forEach(job => {
                container.innerHTML += `
                    <div class="bg-white rounded-2xl shadow-lg border-l-4 border-amber-500 overflow-hidden relative mb-4 transform transition-all hover:scale-[1.02]">
                        <div class="p-4 bg-amber-50/30">
                            <div class="flex justify-between items-start mb-3">
                                <div>
                                    <span class="bg-red-500 text-white text-[10px] font-bold px-2 py-0.5 rounded animate-pulse shadow-sm shadow-red-500/50">‡∏á‡∏≤‡∏ô‡πÉ‡∏´‡∏°‡πà‡πÄ‡∏Ç‡πâ‡∏≤!</span>
                                    <p class="text-xs font-bold text-gray-800 mt-1">${job.orderId}</p>
                                </div>
                                <div class="text-right">
                                    <p class="text-[10px] text-gray-500 font-bold">‡∏Ñ‡πà‡∏≤‡∏à‡∏±‡∏î‡∏™‡πà‡∏á</p>
                                    <p class="font-bold text-2xl text-amber-500 drop-shadow-sm">${job.deliveryFee} <span class="text-sm">‡∏ø</span></p>
                                </div>
                            </div>
                            
                            <div class="relative pl-4 border-l-2 border-dashed border-gray-300 ml-2 space-y-3 mb-4 mt-2">
                                <div class="relative">
                                    <div class="absolute -left-[21px] top-0 w-4 h-4 bg-gray-800 rounded-full border-2 border-white"></div>
                                    <p class="text-[10px] font-bold text-gray-400">‡∏£‡∏±‡∏ö‡∏≠‡∏≤‡∏´‡∏≤‡∏£‡∏ó‡∏µ‡πà</p>
                                    <p class="font-bold text-sm text-gray-800">${job.shopName}</p>
                                </div>
                                <div class="relative">
                                    <div class="absolute -left-[21px] top-0 w-4 h-4 bg-emerald-500 rounded-full border-2 border-white"></div>
                                    <p class="text-[10px] font-bold text-gray-400">‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏≠‡∏≤‡∏´‡∏≤‡∏£</p>
                                    <p class="text-xs text-gray-600 line-clamp-2">${job.details}</p>
                                </div>
                            </div>
                            
                            <button onclick="acceptJob('${job.orderId}', this)" class="w-full bg-gray-800 hover:bg-gray-900 text-white font-bold py-3.5 rounded-xl shadow-md active:scale-95 text-base flex justify-center items-center gap-2 transition-all">
                                <i class="fas fa-motorcycle"></i> ‡∏Å‡∏î‡∏£‡∏±‡∏ö‡∏á‡∏≤‡∏ô‡∏ô‡∏µ‡πâ‡∏ó‡∏±‡∏ô‡∏ó‡∏µ!
                            </button>
                        </div>
                    </div>`;
            });
        }

        // ‡∏û‡∏µ‡πà‡∏ß‡∏¥‡∏ô‡∏Å‡∏î‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏£‡∏±‡∏ö‡∏á‡∏≤‡∏ô (‡πÅ‡∏¢‡πà‡∏á‡∏á‡∏≤‡∏ô)
        async function acceptJob(orderId, btn) {
            const originalText = btn.innerHTML; 
            btn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÅ‡∏¢‡πà‡∏á‡∏á‡∏≤‡∏ô...'; 
            btn.disabled = true;
            btn.classList.add('opacity-70');
            
            try {
                const response = await fetch(GAS_URL, { 
                    method: 'POST', 
                    body: JSON.stringify({ action: "rider_accept_job", orderId: orderId, riderName: myRiderName }) 
                });
                const result = await response.json();
                
                if(result.status === "success") { 
                    // ‡∏£‡∏±‡∏ö‡∏á‡∏≤‡∏ô‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à ‡πÇ‡∏´‡∏•‡∏î‡∏´‡∏ô‡πâ‡∏≤‡∏à‡∏≠ Active Job ‡∏Ç‡∏∂‡πâ‡∏ô‡∏°‡∏≤‡πÄ‡∏•‡∏¢
                    fetchJobs(); 
                } else { 
                    alert(result.message); // ‡πÇ‡∏î‡∏ô‡∏Ñ‡∏ô‡∏≠‡∏∑‡πà‡∏ô‡πÅ‡∏¢‡πà‡∏á‡πÑ‡∏õ‡πÅ‡∏•‡πâ‡∏ß ‡∏´‡∏£‡∏∑‡∏≠ Error
                    fetchJobs(); 
                } 
            } catch (err) { 
                alert('‡πÄ‡∏Ñ‡∏£‡∏∑‡∏≠‡∏Ç‡πà‡∏≤‡∏¢‡∏Ç‡∏±‡∏î‡∏Ç‡πâ‡∏≠‡∏á ‡∏•‡∏≠‡∏á‡∏Å‡∏î‡∏£‡∏±‡∏ö‡∏á‡∏≤‡∏ô‡πÉ‡∏´‡∏°‡πà‡∏ô‡∏∞‡∏Ñ‡∏∞');
                btn.innerHTML = originalText; 
                btn.disabled = false; 
                btn.classList.remove('opacity-70');
            }
        }

        // ‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏´‡∏ô‡πâ‡∏≤‡∏à‡∏≠‡πÑ‡∏õ‡πÄ‡∏õ‡πá‡∏ô "‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏ß‡∏¥‡πà‡∏á‡∏á‡∏≤‡∏ô"
        function showActiveJob(job) {
            currentJobId = job.orderId;
            document.getElementById('view-job-board').classList.add('hidden');
            document.getElementById('view-job-board').classList.remove('flex');
            document.getElementById('view-active-job').classList.remove('hidden');
            document.getElementById('view-active-job').classList.add('flex');

            document.getElementById('active-order-id').innerText = job.orderId;
            document.getElementById('active-shop-name').innerText = job.shopName;
            document.getElementById('active-delivery-fee').innerText = job.deliveryFee;

            // ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏ß‡∏¥‡∏ò‡∏µ‡∏ä‡∏≥‡∏£‡∏∞‡πÄ‡∏á‡∏¥‡∏ô ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏ö‡∏≠‡∏Å‡∏û‡∏µ‡πà‡∏ß‡∏¥‡∏ô‡∏ß‡πà‡∏≤‡∏ï‡πâ‡∏≠‡∏á‡πÄ‡∏Å‡πá‡∏ö‡πÄ‡∏á‡∏¥‡∏ô‡∏™‡∏î‡πÑ‡∏´‡∏°
            const instruction = document.getElementById('payment-instruction');
            if(job.payMethod === "COD") {
                instruction.innerHTML = `
                    <div class="flex items-start gap-2">
                        <i class="fas fa-money-bill-wave text-red-500 mt-1"></i>
                        <div>
                            <p class="text-[11px] font-bold text-red-500 mb-0.5">!! ‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏à‡πà‡∏≤‡∏¢‡πÄ‡∏á‡∏¥‡∏ô‡∏™‡∏î !!</p>
                            <p class="text-xs text-gray-800">‡πÄ‡∏Å‡πá‡∏ö‡πÄ‡∏á‡∏¥‡∏ô‡∏™‡∏î‡∏à‡∏≤‡∏Å‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤ <span class="font-bold text-red-600 text-lg">${job.netTotal} ‡∏ø</span></p>
                            <p class="text-[10px] text-gray-500 mt-1">(‡∏´‡∏±‡∏Å‡∏Ñ‡πà‡∏≤‡∏™‡πà‡∏á‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì‡πÑ‡∏ß‡πâ ‡πÅ‡∏•‡∏∞‡πÇ‡∏≠‡∏ô‡∏Ñ‡∏∑‡∏ô‡∏£‡πâ‡∏≤‡∏ô‡∏Ñ‡πâ‡∏≤)</p>
                        </div>
                    </div>`;
                instruction.classList.replace('bg-gray-50', 'bg-red-50');
                instruction.classList.replace('border-gray-200', 'border-red-200');
            } else {
                instruction.innerHTML = `
                    <div class="flex items-start gap-2">
                        <i class="fas fa-check-circle text-emerald-500 mt-1"></i>
                        <div>
                            <p class="text-[11px] font-bold text-emerald-600 mb-0.5">‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤‡πÇ‡∏≠‡∏ô‡πÄ‡∏á‡∏¥‡∏ô‡∏ú‡πà‡∏≤‡∏ô‡∏£‡∏∞‡∏ö‡∏ö‡πÅ‡∏•‡πâ‡∏ß</p>
                            <p class="text-xs text-gray-800 font-medium">‡∏™‡πà‡∏á‡∏≠‡∏≤‡∏´‡∏≤‡∏£‡πÉ‡∏´‡πâ‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤‡πÑ‡∏î‡πâ‡πÄ‡∏•‡∏¢ <span class="text-emerald-500 font-bold">‡πÑ‡∏°‡πà‡∏ï‡πâ‡∏≠‡∏á‡πÄ‡∏Å‡πá‡∏ö‡πÄ‡∏á‡∏¥‡∏ô‡πÄ‡∏û‡∏¥‡πà‡∏°</span></p>
                            <p class="text-[10px] text-gray-500 mt-1">(‡∏£‡πâ‡∏≤‡∏ô‡∏Ñ‡πâ‡∏≤‡∏à‡∏∞‡πÇ‡∏≠‡∏ô‡∏Ñ‡πà‡∏≤‡∏™‡πà‡∏á ${job.deliveryFee} ‡∏ø ‡πÉ‡∏´‡πâ‡∏Ñ‡∏∏‡∏ì)</p>
                        </div>
                    </div>`;
                instruction.classList.replace('bg-red-50', 'bg-emerald-50');
                instruction.classList.replace('border-red-200', 'border-emerald-200');
            }
        }

        // ‡πÑ‡∏£‡πÄ‡∏î‡∏≠‡∏£‡πå‡∏Å‡∏î‡∏õ‡∏¥‡∏î‡∏à‡πä‡∏≠‡∏ö (‡∏™‡πà‡∏á‡∏≠‡∏≤‡∏´‡∏≤‡∏£‡πÄ‡∏™‡∏£‡πá‡∏à‡πÅ‡∏•‡πâ‡∏ß)
        async function completeJob() {
            if(!confirm("‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢! ‡∏Ñ‡∏∏‡∏ì‡∏™‡πà‡∏á‡∏≠‡∏≤‡∏´‡∏≤‡∏£‡πÉ‡∏´‡πâ‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤‡πÄ‡∏™‡∏£‡πá‡∏à‡πÅ‡∏•‡πâ‡∏ß‡πÉ‡∏ä‡πà‡πÑ‡∏´‡∏°‡∏Ñ‡∏∞?")) return;
            
            const btn = document.getElementById('btn-complete-job'); 
            const originalText = btn.innerHTML;
            btn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏õ‡∏¥‡∏î‡∏á‡∏≤‡∏ô...'; 
            btn.disabled = true;
            btn.classList.replace('bg-emerald-500', 'bg-gray-400');
            
            try {
                const response = await fetch(GAS_URL, { 
                    method: 'POST', 
                    body: JSON.stringify({ action: "rider_complete_job", orderId: currentJobId }) 
                });
                const result = await response.json();
                
                if(result.status === "success") { 
                    alert("‡∏õ‡∏¥‡∏î‡∏á‡∏≤‡∏ô‡∏™‡∏ß‡∏¢‡∏á‡∏≤‡∏°! ‡πÄ‡∏¢‡∏µ‡πà‡∏¢‡∏°‡∏°‡∏≤‡∏Å‡∏Ñ‡πà‡∏∞‡∏û‡∏µ‡πà‡∏ß‡∏¥‡∏ô! üëè"); 
                    fetchJobs(); // ‡∏£‡∏µ‡πÇ‡∏´‡∏•‡∏î‡∏£‡∏∞‡∏ö‡∏ö‡∏Å‡∏•‡∏±‡∏ö‡πÑ‡∏õ‡∏´‡∏ô‡πâ‡∏≤‡πÄ‡∏£‡∏î‡∏≤‡∏£‡πå
                } else {
                    alert("‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏Ñ‡πà‡∏∞");
                }
            } catch (err) { 
                alert('‡∏£‡∏∞‡∏ö‡∏ö‡∏Ç‡∏±‡∏î‡∏Ç‡πâ‡∏≠‡∏á ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏•‡∏≠‡∏á‡∏Å‡∏î‡∏≠‡∏µ‡∏Å‡∏Ñ‡∏£‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏∞'); 
            } finally { 
                btn.innerHTML = originalText; 
                btn.disabled = false; 
                btn.classList.replace('bg-gray-400', 'bg-emerald-500');
            }
        }
    </script>
</body>
</html>
